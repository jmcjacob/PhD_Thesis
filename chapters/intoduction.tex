\section{Introduction to Problem}
\label{sec:intoduction_to_problem}
Modern deep learning algorithms have been shown to improve performance for medical image analysis tasks such as classification, segmentation, and detection for different medical modalities including digital pathology. However, deep learning algorithms require large, annotated datasets to train models as these models learn a deep feature representation as well as a discriminative classifier. When dealing with medical images, annotation can be expensive as annotating requires specialist training and can be very time intensive. This requirement for annotated data has been identified as a key challenge for using deep learning algorithms for medical image analysis in general~\citep{litjens2017survey}. 


\section{Research Contributions}
\label{sec:research_contributions}

In this thesis we propose a pathway used to train medical image analysis systems that can take advantage of unannotated data and produce a system that is both selective and cost sensitive in order to minimise risk used as part of a clinical pipeline. The contributions that form the building blocks for this pathway are as followed:

\begin{itemize}
	\item An active learning framework for histopathology patches that samples larger patches for annotation to increase annotation throughput without adding additional work to annotators.
	
	\item Multi-directional contrastive predictive coding, A unsupervised representation learning algorithm built for medical images with no clear directionality.

	\item A empirical comparison of calibration methods for deep medical image classifiers on histopathology patches and skin lesions images.
	
	\item A comparison of selective classification methods in both binary and multi class settings covering Bayesian neural networks, calibrated neural networks and purpose built models for selective classification.
	
	\item A proposed method for selective classification that makes decisions based on expected costs in situations with asymmetric misclassification costs.
	
	\item Something about Selective Triage
	
	\item Something about dataset generalisation
\end{itemize}



\section{Thesis Structure}
\label{sec:thesis_structure}
These need to be revised.

\subsection*{Annotator Efficient Active Learning}
As deep learning gains popularity in medical image analysis and digital pathology~\citep{tizhoosh2018artificial}, methods for reducing the need for costly data annotations become increasingly important. Active learning is a promising approach that can reduce the amount of annotated data required to train machine learning models~\citep{settles2012active}, but traditional active learning strategies are not always effective with deep learning (Wang et al., 2016). In patch-based machine learning systems, active learning methods typically request annotations for individual small patches, which can be tedious and costly for annotators who must rely on visual context. To address this issue, we propose an active learning framework that selects regions for annotation that are composed of multiple patches, which should increase annotation throughput~\citep{carse2019active}. The framework was evaluated with various query strategies on the task of nuclei classification, using convolutional neural networks trained on small patches containing single nuclei. Traditional query strategies performed worse than random sampling.

\subsection*{Unsupervised Representation Learning}
Recent advancements in deep learning algorithms have significantly benefited digital pathology tasks. However, a major obstacle in this field is the requirement for large amounts of annotated data. To address this issue, unsupervised learning techniques, specifically contrastive predictive coding (CPC), have been proposed as a solution for utilizing abundant but unannotated data to train classifiers. In this study, we propose a modification to the CPC framework for use in digital pathology patch classification, which includes the use of an alternative mask to construct the latent context and a multi-directional PixelCNN autoregressor. By implementing this method on the Patch Camelyon histology dataset, we demonstrate that it can effectively produce deep feature representations for improved classification accuracy in digital pathology.

\subsection*{Predictive Probability Calibration}
It has been well established that the deployment of deep learning classifiers for medical image analysis tasks requires careful consideration of issues related to predictive calibration~\cite{maron2019systematic}. Mis-calibration, defined as the deviation between predictive probability (confidence) and classification correctness~\cite{guo2017calibration}, can significantly impact the ability to make cost-sensitive and selective decisions~\cite{carse2021robust}. To better understand the effectiveness of various calibration methods, an empirical study was conducted using two medical image datasets: one for multi-class dermatology classification and one for binary histopathology image classification. The temperature scaling method, in which the temperature parameter is optimized using various measures of calibration in place of the standard negative log-likelihood, was applied to networks trained with one-hot encoding and cross-entropy loss, as well as networks trained with focal loss and label smoothing. The results of these methods were also compared to those obtained using two Bayesian neural network approaches. The findings of this study suggest that while alternative calibration metrics may not offer significant advantages for tuning temperature, temperature scaling of networks trained with focal loss and appropriate hyperparameters showed strong performance in terms of both calibration and accuracy across both datasets~\cite{carse2022calibration}.

\subsection*{Asymmetrical Selective Classification}
Automated image analysis of skin lesions has potential to improve diagnostic decision making. A clinically useful system should be selective, rejecting images it is ill-equipped to classify, for example because they are of lesion types not represented well in training data. Furthermore, lesion classifiers should support cost-sensitive decision making. We investigate methods for selective, cost-sensitive classification within a binary setting of benign or malignant using test images of lesion types represented and not represented in training data. Further experiments with multi-class selective cost-sensitive classification with misclassification costs provided by clinical dermatologists based on healthcare economics. We experiment with different methods of uncertainty estimation with neural networks and probability calibration.
% Needs editing when experiment results are in.
We introduce EC-SelectiveNet, a modification to SelectiveNet that discards the selection head at test time, making decisions based on expected costs instead. Experiments show that training for full coverage is beneficial even when operating at lower coverage, and that EC-SelectiveNet outperforms standard cross-entropy training, whether temperature scaling or Monte Carlo dropout averaging are used, in both symmetric and asymmetric cost settings.

\subsection*{Cross Site Generalisation}
This study aims to assess the generalizability of deep neural network classifiers for macroscopic skin lesion images obtained from the NHS in the UK. The application of deep learning in dermatology has received attention in the literature, with some studies reporting diagnostic accuracy comparable to that of experienced dermatologists on highly curated datasets. However, most skin disease images encountered in clinical settings are macroscopic and lack dermoscopic information, presenting a significant challenge for deep learning algorithms. To address this challenge, two diagnostic image datasets were created and labelled, comprising 2218 community-acquired images from NHS Tayside and 1518 macroscopic images from NHS Forth Valley. Additionally, two further datasets with identical diagnostic labels were obtained from public domain sources, the ISIC dermoscopic dataset and the SD-260 non-dermoscopic dataset. Two types of neural network models were trained on each of these datasets, and cross-dataset experiments were conducted by evaluating the performance of each model on the other datasets. The results reveal that pre-training on the SD-260 dataset followed by fine-tuning on the target domain data was an effective strategy for improving performance, demonstrating the superiority of utilizing vast public macroscopic datasets for pre-training and fine-tuning with locally sourced community-acquired data. The findings of this study highlight the importance of considering the generalizability of deep learning algorithms for macroscopic skin lesion images in real-world settings and the potential benefits of utilizing vast public macroscopic datasets for pre-training and fine-tuning. Further research is necessary to determine the generalizability of these algorithms across populations and acquisition settings.

\subsection*{Conclusion}
